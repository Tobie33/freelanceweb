<script>
  const replaceDynamicLinks = ({ isLoading, user } = {}) => {
    const checkLoginOrSignup = window.location.pathname.split("/").reverse()[0]

    if (isLoading) return $('#navbar-dynamic-links').html('loading...')
    if(checkLoginOrSignup === "signup" || checkLoginOrSignup === "login"){
      return $('#navbar-dynamic-links').html('')
    }

    const links = `
      ${user ? `
          <a class="nav-link" href="/users">
            <li class="nav-item p-2">
              All Users
            </li>
          </a>
          <a class="nav-link" href="/my/profile">
            <li class="nav-item p-2">
              My profile
            </li>
          </a>

          <a id="auth-logout" class="nav-link text-danger" href="#">
            <li class="nav-item p-2">
              Logout
            </li>
          </a>
        ` : `
          <a class="nav-link" href="/auth/signup">
            <li class="nav-item p-2">
              Signup
            </li>
          </a>

          <a class="nav-link" href="/auth/login">
            <li class="nav-item p-2">
              Login
            </li>
          </a>
        `
      }
    `

    $('#navbar-dynamic-links').html(links)
  }
  const getMyProfile = () => {
    replaceDynamicLinks({ isLoading: true })
    axios({
      method: 'GET',
      url: '/api/my/profile',
    }).then((resp) => {
      replaceDynamicLinks({ user: resp.data })
    }).catch(() => {
      replaceDynamicLinks()
    })
  }
  const handleLogout = (e) => {
    e.preventDefault()
    axios({
      method: 'DELETE',
      url: '/api/auth/logout'
    }).then(() => {
      window.location.href = '/'
    })
  }
  $(document).ready(() => {
    getMyProfile()
    $('body').on('click', '#auth-logout', handleLogout)
  })
</script>

<nav class="navbar navbar-expand-lg navbar-light">
  <div class="container-fluid">
    <div id="main-page-button">
      <a class="navbar-brand" href="/">
        Main Page
      </a>
    </div>
    <div id="github">
      <a class="navbar-brand" href="https://github.com/Tobie33/freelanceweb">
        Github
      </a>
    </div>
    <button class="navbar-toggler " type="button" data-bs-toggle="collapse" data-bs-target="#navbar-links">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbar-links">
      <ul id="navbar-dynamic-links" class="navbar-nav ms-auto mb-2 mb-lg-0"></ul>
    </div>
  </div>
</nav>
